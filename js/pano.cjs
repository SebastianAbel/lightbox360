var h;function l(){this.L=40;this.c=this.m=30+90*(1-this.L/100);this.N=mat4.create();this.O=mat4.create();this.F=null}h=l.prototype;
h.Y=function(a){var b=this;this.canvas=a;try{this.a=a.getContext("experimental-webgl"),this.R(a.width,a.height)}catch(c){this.K=!1;return}this.K=!0;this.a.clearColor(1,0,1,1);this.a.enable(this.a.DEPTH_TEST);this.c=this.a.v/this.a.w*this.m*1;this.h=new m(a,this);this.h.c=this.c;this.ca=new p(this.a);var d=new q(this.a);r(d,function(){var a;a=d.a.createShader(d.a.VERTEX_SHADER);d.a.shaderSource(a,d.A[0]);d.a.compileShader(a);if(d.a.getShaderParameter(a,d.a.COMPILE_STATUS)){var c=d.a.createShader(d.a.FRAGMENT_SHADER);
d.a.shaderSource(c,d.A[1]);d.a.compileShader(c);d.a.getShaderParameter(c,d.a.COMPILE_STATUS)?(shaderPgm=d.a.createProgram(),d.a.attachShader(shaderPgm,a),d.a.attachShader(shaderPgm,c),d.a.linkProgram(shaderPgm),d.a.getProgramParameter(shaderPgm,d.a.LINK_STATUS)||alert("Unable to initialize the shader program."),shaderPgm.T=d.a.getAttribLocation(shaderPgm,"aVertexPosition"),d.a.enableVertexAttribArray(shaderPgm.T),shaderPgm.S=d.a.getAttribLocation(shaderPgm,"aTextureCoord"),d.a.enableVertexAttribArray(shaderPgm.S),
shaderPgm.aa=d.a.getUniformLocation(shaderPgm,"uPMatrix"),shaderPgm.$=d.a.getUniformLocation(shaderPgm,"uMVMatrix"),a=shaderPgm):(alert(d.a.getShaderInfoLog(c)),a=null)}else alert(d.a.getShaderInfoLog(a)),a=null;b.s=a;t(b)})};h.Z=function(){return this.K};h.R=function(a,b){this.width=a;this.height=b;this.canvas.width=a;this.canvas.height=b;this.a.w=a;this.a.v=b;this.c=this.a.v/this.a.w*this.m*1;null!=this.h&&(this.h.c=this.c);t(this)};
h.ba=function(a){var b=this;this.F=null;this.P(this.L);this.h.c=this.c;b.h.reset();u(new v(this.a),a,function(a){b.F=a;t(b)})};h.P=function(a){this.m=30+90*(1-a/100);this.c=this.a.v/this.a.w*this.m*1;this.h.c=this.c;t(this)};h.W=function(){return-100*((this.m-30)/90-1)};
function t(a){if(null!=a.s&&(a.a.viewport(0,0,a.a.w,a.a.v),a.a.clear(a.a.COLOR_BUFFER_BIT|a.a.DEPTH_BUFFER_BIT),null!=a.F)){mat4.perspective(a.c,a.a.w/a.a.v,.1,10,a.O);var b=a.h;mat4.multiply(b.J,b.o,a.N);a.a.useProgram(a.s);a.a.activeTexture(a.a.TEXTURE0);a.a.bindTexture(a.a.TEXTURE_2D,a.F);a.a.uniform1i(a.a.getUniformLocation(a.s,"uSampler"),0);a.a.uniformMatrix4fv(a.s.aa,!1,a.O);a.a.uniformMatrix4fv(a.s.$,!1,a.N);b=a.ca;a=a.s;b.a.bindBuffer(b.a.ARRAY_BUFFER,b.u);b.a.vertexAttribPointer(a.T,b.u.M,
b.a.FLOAT,!1,0,0);b.a.bindBuffer(b.a.ARRAY_BUFFER,b.H);b.a.vertexAttribPointer(a.S,2,b.a.FLOAT,!1,0,0);b.a.bindBuffer(b.a.ELEMENT_ARRAY_BUFFER,b.G);b.a.drawElements(b.a.TRIANGLES,b.G.I,b.a.UNSIGNED_SHORT,0)}}h.V=function(){return!1};window.Pano=l;l.prototype.isAvailable=l.prototype.Z;l.prototype.init=l.prototype.Y;l.prototype.setSize=l.prototype.R;l.prototype.setImage=l.prototype.ba;l.prototype.fullscreen=l.prototype.V;l.prototype.setFovScale=l.prototype.P;l.prototype.getFovScale=l.prototype.W;function p(a){this.a=a;for(var b=[],c=[],d=[],f=0,e=0;33>f;f++)for(var g=Math.sin(f*Math.PI/32),n=Math.cos(f*Math.PI/32),k=0;33>k;k++,e++){var y=Math.cos(2*k*Math.PI/32);b[3*e+0]=Math.sin(2*k*Math.PI/32)*g;b[3*e+1]=n;b[3*e+2]=y*g;d[2*e+0]=1-k/32;d[2*e+1]=f/32}for(e=f=0;32>f;f++)for(k=0;32>k;k++,e++)c[6*e+0]=33*f+k,c[6*e+1]=33*f+(k+1),c[6*e+2]=33*(f+1)+k,c[6*e+3]=33*f+(k+1),c[6*e+4]=33*(f+1)+(k+1),c[6*e+5]=33*(f+1)+k;this.u=this.a.createBuffer();this.a.bindBuffer(a.ARRAY_BUFFER,this.u);this.a.bufferData(a.ARRAY_BUFFER,
new Float32Array(b),this.a.STATIC_DRAW);this.u.M=3;this.u.I=1089;this.H=this.a.createBuffer();this.a.bindBuffer(a.ARRAY_BUFFER,this.H);this.a.bufferData(a.ARRAY_BUFFER,new Float32Array(d),this.a.STATIC_DRAW);this.H.M=2;this.H.I=1089;this.G=a.createBuffer();this.a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.G);this.a.bufferData(a.ELEMENT_ARRAY_BUFFER,new Uint16Array(c),this.a.STATIC_DRAW);this.G.I=6144};function q(a){this.a=a;this.da="shaders/unlit_texture.vs";this.U="shaders/unlit_texture.fs";this.A=[null,null]}function r(a,b){w([a.da,a.U],function(c){a.A[0]=c[0];a.A[1]=c[1];b()},function(a){alert('Failed to download "'+a+'"')})};function w(a,b,c){function d(a,c){g[c]=a;e++;e==f&&b(g)}for(var f=a.length,e=0,g=[],n=0;n<f;n++)x(a[n],n,d,c)}function x(a,b,c,d){var f=new XMLHttpRequest;f.open("GET",a,!0);f.onreadystatechange=function(){4==f.readyState&&(200==f.status?c(f.responseText,b):d(a))};f.send(null)};function v(a){this.a=a;this.X=navigator.userAgent.match(/(iPad|iPhone|iPod)/g)?!0:!1}function u(a,b,c){z(a,b,a.a.createTexture(),c)}
function z(a,b,c,d){function f(a){return 0==(a&a-1)}function e(a){--a;for(var c=1;32>c;c<<=1)a=a|a>>c;return a+1}a.a.bindTexture(a.a.TEXTURE_2D,c);if(a.X&&(!f(b.width)||!f(b.height))){var g=document.createElement("canvas");for(g.width=e(b.width);2048<g.width;)g.width/=2;for(g.height=e(b.height);2048<g.height;)g.height/=2;g.getContext("2d").drawImage(b,0,0,g.width,g.height);b=g}a.a.texImage2D(a.a.TEXTURE_2D,0,a.a.RGBA,a.a.RGBA,a.a.UNSIGNED_BYTE,b);a.a.texParameteri(a.a.TEXTURE_2D,a.a.TEXTURE_MAG_FILTER,
a.a.LINEAR);a.a.texParameteri(a.a.TEXTURE_2D,a.a.TEXTURE_MIN_FILTER,a.a.LINEAR);a.a.texParameteri(a.a.TEXTURE_2D,a.a.TEXTURE_WRAP_S,a.a.CLAMP_TO_EDGE);a.a.texParameteri(a.a.TEXTURE_2D,a.a.TEXTURE_WRAP_T,a.a.CLAMP_TO_EDGE);a.a.bindTexture(a.a.TEXTURE_2D,null);null!=d&&d(c)};function m(a,b){var c=this;this.i=!1;this.J=mat4.create();mat4.identity(this.J);mat4.translate(this.J,[0,0,0]);this.o=mat4.create();mat4.identity(this.o);this.B;this.C;this.c=this.b=this.g=this.l=this.j=0;this.D=b;this.canvas=a;this.canvas.addEventListener("mousedown",function(a){c.i=!0;null!=c.f&&(clearInterval(c.f),c.f=null);var b=c.canvas.getBoundingClientRect(),e=800/c.canvas.width,g=(a.clientY-b.top)*e;c.B=(a.clientX-b.left)*e;c.C=g},!0);this.canvas.addEventListener("mousemove",function(a){if(c.i){var b=
c.canvas.getBoundingClientRect(),e=800/c.canvas.width;A(c,(a.clientX-b.left)*e,(a.clientY-b.top)*e);t(c.D)}},!0);this.canvas.addEventListener("mouseup",function(){c.i=!1;c.f=setInterval(function(){B(c);t(c.D)},1E3/60)},!0);this.canvas.addEventListener("touchstart",function(a){a.preventDefault();c.i=!0;null!=c.f&&(clearInterval(c.f),c.f=null);var b=c.canvas.getBoundingClientRect(),e=800/c.canvas.width,g=(a.targetTouches[0].pageY-b.top)*e;c.B=(a.targetTouches[0].pageX-b.left)*e;c.C=g},!0);this.canvas.addEventListener("touchmove",
function(a){a.preventDefault();if(c.i){var b=c.canvas.getBoundingClientRect(),e=800/c.canvas.width;A(c,(a.targetTouches[0].pageX-b.left)*e,(a.targetTouches[0].pageY-b.top)*e);t(c.D)}},!0);this.canvas.addEventListener("touchend",function(){c.i=!1;c.f=setInterval(function(){B(c);t(c.D)},1E3/60)},!0)}m.prototype.reset=function(){this.b=this.g=this.l=this.j=0;this.o=mat4.create();mat4.identity(this.o)};
function A(a,b,c){var d=a.B-b,f=a.C-c;a.B=b;a.C=c;a.j=d;a.l=f;b=.25*a.c/90;a.g+=d*b;a.b+=f*b;90<a.b?a.b=90:-90>a.b&&(a.b=-90);d=mat4.create();mat4.identity(d);mat4.rotate(d,a.b*Math.PI/180,[1,0,0]);mat4.rotate(d,a.g*Math.PI/180,[0,1,0]);a.o=d}
function B(a){a.j*=.95;a.l*=.95;.01>Math.abs(a.j)&&.01>Math.abs(a.l)&&(clearInterval(a.f),a.f=null);var b=a.l,c=.25*a.c/90;a.g+=a.j*c;a.b+=b*c;90<a.b?a.b=90:-90>a.b&&(a.b=-90);b=mat4.create();mat4.identity(b);mat4.rotate(b,a.b*Math.PI/180,[1,0,0]);mat4.rotate(b,a.g*Math.PI/180,[0,1,0]);a.o=b};
