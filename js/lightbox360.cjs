/*
 http://creativecommons.org/licenses/by/2.5/
 - Free for use in both personal and commercial projects
 - Attribution requires leaving author name, author link, and the license info intact
*/
(function(){var e=jQuery,D=function(){function e(){this.wa=500;this.Ia=!0;this.ua=700;this.Ea=50;this.Wa=!0;this.za=this.Na=!1}e.prototype.Ma=function(a,d){return"Image "+a+" of "+d};return e}(),E=function(){function b(a){this.options=a;this.ma=[];this.na=void 0;this.init()}b.prototype.init=function(){this.enable();this.Oa()};b.prototype.enable=function(){var a=this;e("body").on("click","a[rel^=lightbox], area[rel^=lightbox], a[data-lightbox], area[data-lightbox]",function(d){a.start(e(d.currentTarget));
return!1})};b.prototype.Oa=function(){var a=this;e("<div id='lightboxOverlay' class='lightboxOverlay'></div><div id='lightbox' class='lightbox'><div class='lb-outerContainer'><div class='lb-container'><canvas id='pano-canvas' class='lb-canvas' /><img class='lb-image' src='' /><div class='lb-nav'><a class='lb-prev' href='' ></a><a class='lb-next' href='' ></a></div><div class='lb-pano_nav'><a class='lb-pano_prev' href='' ></a><a class='lb-pano_next' href='' ></a></div><div class='lb-pano_control'><a class='lb-pano_full' href='' ></a><a class='lb-pano_full_back' href='' ></a><input type=range class='lb-pano_zoom' min=0 value=40 max=100 /></div><div class='lb-loader'><a class='lb-cancel'></a></div></div></div><div class='lb-dataContainer'><div class='lb-data'><div class='lb-details'><span class='lb-caption'></span><span class='lb-number'></span></div><div class='lb-closeContainer'><a class='lb-close'></a></div></div></div></div>").appendTo(e("body"));
this.la=e("#lightbox");this.va=e("#lightboxOverlay");this.pa=this.la.find(".lb-outerContainer");this.ra=this.la.find(".lb-container");this.Da=parseInt(this.ra.css("padding-top"),10);this.Ca=parseInt(this.ra.css("padding-right"),10);this.Aa=parseInt(this.ra.css("padding-bottom"),10);this.Ba=parseInt(this.ra.css("padding-left"),10);this.va.hide().on("click",function(){a.end();return!1});this.la.hide().on("click",function(d){"lightbox"===e(d.target).attr("id")&&a.end();return!1});this.pa.on("click",
function(d){"lightbox"===e(d.target).attr("id")&&a.end();return!1});this.la.find(".lb-prev").on("click",function(){0===a.na?a.qa(a.ma.length-1):a.qa(a.na-1);return!1});this.la.find(".lb-next").on("click",function(){a.na===a.ma.length-1?a.qa(0):a.qa(a.na+1);return!1});this.la.find(".lb-pano_prev").on("click",function(){0===a.na?a.qa(a.ma.length-1):a.qa(a.na-1);return!1});this.la.find(".lb-pano_next").on("click",function(){a.na===a.ma.length-1?a.qa(0):a.qa(a.na+1);return!1});this.la.find(".lb-loader, .lb-close").on("click",
function(){a.end();return!1});this.la.find(".lb-pano_full").on("click",function(){a.Sa();return!1});this.la.find(".lb-pano_full_back").on("click",function(){a.Ta();return!1});this.la.find(".lb-pano_zoom").on("input",function(){a.Ua(a.la.find(".lb-pano_zoom").val());return!1});this.ta=this.la.find(".lb-canvas").width();this.sa=this.la.find(".lb-canvas").height();this.la.find(".lb-canvas").width("auto");this.la.find(".lb-canvas").height("auto")};b.prototype.start=function(a){function d(a){n.ma.push({link:a.attr("href"),
title:a.attr("data-title")||a.attr("title"),xa:a.attr("pano-type"),ta:a.attr("pano-width"),sa:a.attr("pano-height")})}var n=this,c=e(window);c.on("resize",e.proxy(this.ya,this));e("select, object, embed").css({visibility:"hidden"});this.ya();this.ma=[];var b=0,f=a.attr("data-lightbox");if(f)for(var f=e(a.prop("tagName")+'[data-lightbox="'+f+'"]'),h=0;h<f.length;h=++h)d(e(f[h])),f[h]===a[0]&&(b=h);else if("lightbox"===a.attr("rel"))d(a);else for(f=e(a.prop("tagName")+'[rel="'+a.attr("rel")+'"]'),h=
0;h<f.length;h=++h)d(e(f[h])),f[h]===a[0]&&(b=h);a=c.scrollTop()+this.options.Ea;c=c.scrollLeft();this.la.css({top:a+"px",left:c+"px"}).fadeIn(this.options.wa);this.qa(b)};b.prototype.qa=function(a){var d=this;this.Ga();var b=this.la.find(".lb-image");this.va.fadeIn(this.options.wa);e(".lb-loader").fadeIn("slow");this.la.find(".lb-image, .lb-nav, .lb-prev, .lb-next, .lb-dataContainer, .lb-numbers, .lb-caption").hide();this.la.find(".lb-canvas, .lb-pano_nav, .lb-pano_prev, .lb-pano_next, .lb-pano_control, .lb-pano_full, .lb-pano_full_back").hide();
this.pa.addClass("animating");null!=this.oa&&this.oa.hasVideo()&&this.oa.clearVideo();this.na=a;if("sphere-video"==this.ma[a].xa){var c=new Image;null==this.oa&&(this.oa=new Pano,this.oa.init(this.la.find(".lb-canvas").get(0)));this.oa.isAvailable()&&(c.width=null!=this.ma[a].ta?this.ma[a].ta:this.ta,c.height=null!=this.ma[a].sa?this.ma[a].sa:this.sa,b.width(c.width),b.height(c.height),this.options.Ia&&(windowWidth=e(window).width(),windowHeight=e(window).height(),maxImageWidth=windowWidth-this.Ba-
this.Ca-20,maxImageHeight=windowHeight-this.Da-this.Aa-120,c.width>maxImageWidth||c.height>maxImageHeight)&&(c.width/maxImageWidth>c.height/maxImageHeight?(imageWidth=maxImageWidth,imageHeight=parseInt(c.height/(c.width/imageWidth),10)):(imageHeight=maxImageHeight,imageWidth=parseInt(c.width/(c.height/imageHeight),10)),b.width(imageWidth),b.height(imageHeight)),this.Ka(b.width(),b.height()))}else c=new Image,c.onload=function(){var k,f;b.attr("src",d.ma[a].link);e(c);null!=d.ma[a].xa&&(null==d.oa&&
(d.oa=new Pano,d.oa.init(d.la.find(".lb-canvas").get(0))),d.oa.isAvailable()&&(c.width=null!=d.ma[a].ta?d.ma[a].ta:d.ta,c.height=null!=d.ma[a].sa?d.ma[a].sa:d.sa));b.width(c.width);b.height(c.height);d.options.Ia&&(k=e(window).width(),f=e(window).height(),k=k-d.Ba-d.Ca-20,f=f-d.Da-d.Aa-120,c.width>k||c.height>f)&&(c.width/k>c.height/f?(f=k,k=parseInt(c.height/(c.width/f),10)):(k=f,f=parseInt(c.width/(c.height/k),10)),b.width(f),b.height(k));d.Ka(b.width(),b.height())};c.src=this.ma[a].link};b.prototype.ya=
function(){this.va.width(e(window).width()).height(e(document).height())};b.prototype.Ka=function(a,d){function b(){c.la.find(".lb-dataContainer").width(h);c.la.find(".lb-prevLink").height(A);c.la.find(".lb-nextLink").height(A);null!=c.ma[c.na].xa&&c.oa.isAvailable()?c.Xa(a,d):c.Va()}var c=this,k=this.pa.outerWidth(),f=this.pa.outerHeight(),h=a+this.Ba+this.Ca,A=d+this.Da+this.Aa;if(this.Fa){this.la.addClass("animating");var D=e(window).scrollTop()+this.options.Ea;this.la.animate({top:D+"px"},this.options.ua,
"swing",function(){c.la.removeClass("animating");c.Fa=!1})}k!==h||f!==A?this.pa.animate({width:h,height:A},this.options.ua,"swing",function(){b()}):b()};b.prototype.Va=function(){this.la.find(".lb-loader").hide();this.la.find(".lb-image").fadeIn("slow");this.Ya();this.La();this.Ja();this.Ha()};b.prototype.Xa=function(a,d){this.la.find(".lb-loader").hide();this.la.find(".lb-canvas").fadeIn("slow");this.Za();this.La();this.Ja();this.Ha();this.la.find(".lb-canvas").get(0).width=a;this.la.find(".lb-canvas").get(0).height=
d;this.oa.setSize(a,d);var b=this.la.find(".lb-image");"sphere-video"==this.ma[this.na].xa?this.oa.setVideo(this.ma[this.na].link):this.oa.setImage(b.get(0));this.la.find(".lb-pano_zoom").val(this.oa.getFovScale())};b.prototype.Ya=function(){var a=!1;try{document.createEvent("TouchEvent"),a=this.options.Na?!0:!1}catch(b){}this.la.find(".lb-nav").show();1<this.ma.length&&(this.options.za?(a&&this.la.find(".lb-prev, .lb-next").css("opacity","1"),this.la.find(".lb-prev, .lb-next").show()):(0<this.na&&
(this.la.find(".lb-prev").show(),a&&this.la.find(".lb-prev").css("opacity","1")),this.na<this.ma.length-1&&(this.la.find(".lb-next").show(),a&&this.la.find(".lb-next").css("opacity","1"))))};b.prototype.Za=function(){this.la.find(".lb-pano_nav").show();this.la.find(".lb-pano_control").show();this.la.find(".lb-pano_full").show();this.la.find(".lb-pano_full").css("opacity","1");this.la.find(".lb-pano_zoom").show();1<this.ma.length&&(this.options.za?(this.la.find(".lb-pano_prev, .lb-pano_next").css("opacity",
"1"),this.la.find(".lb-pano_prev, .lb-pano_next").show()):(0<this.na&&(this.la.find(".lb-pano_prev").show(),this.la.find(".lb-pano_prev").css("opacity","1")),this.na<this.ma.length-1&&(this.la.find(".lb-pano_next").show(),this.la.find(".lb-pano_next").css("opacity","1"))))};b.prototype.La=function(){var a=this;if("undefined"!==typeof this.ma[this.na].title&&""!==this.ma[this.na].title)this.la.find(".lb-caption").html(this.ma[this.na].title).fadeIn("fast").find("a").on("click",function(){location.href=
e(this).attr("href")});1<this.ma.length&&this.options.Wa?this.la.find(".lb-number").text(this.options.Ma(this.na+1,this.ma.length)).fadeIn("fast"):this.la.find(".lb-number").hide();this.pa.removeClass("animating");this.la.find(".lb-dataContainer").fadeIn(this.options.ua,function(){return a.ya()})};b.prototype.Ja=function(){this.ma.length>this.na+1&&((new Image).src=this.ma[this.na+1].link);0<this.na&&((new Image).src=this.ma[this.na-1].link)};b.prototype.Ha=function(){e(document).on("keyup.keyboard",
e.proxy(this.Pa,this))};b.prototype.Ga=function(){e(document).off(".keyboard")};b.prototype.Pa=function(a){a=a.keyCode;var b=String.fromCharCode(a).toLowerCase();if(27===a||b.match(/x|o|c/))this.end();else if("p"===b||37===a)0!==this.na?this.qa(this.na-1):this.options.za&&1<this.ma.length&&this.qa(this.ma.length-1);else if("n"===b||39===a)this.na!==this.ma.length-1?this.qa(this.na+1):this.options.za&&1<this.ma.length&&this.qa(0)};b.prototype.end=function(){this.Ga();e(window).off("resize",this.ya);
this.la.fadeOut(this.options.wa);this.va.fadeOut(this.options.wa);e("select, object, embed").css({visibility:"visible"});null!=this.oa&&this.oa.hasVideo()&&this.oa.clearVideo()};b.prototype.Sa=function(){var a=this;if(null!=this.oa&&!this.oa.fullscreen()){this.la.find(".lb-pano_full").hide();this.la.find(".lb-pano_zoom").hide();e("body").css({overflow:"hidden"});this.la.addClass("animating");var b=e(window).scrollTop();this.Fa=!0;this.la.animate({top:b+"px"},this.options.ua,"swing",function(){a.la.removeClass("animating")});
var n=a.pa.width()-a.ra.width(),c=a.pa.height()-a.ra.height(),k=setInterval(function(){var b=a.pa.width()-n,d=a.pa.height()-c;a.oa.setSize(b,d)},1E3/60);this.Ra=a.pa.width();this.Qa=a.pa.height();this.pa.addClass("animating");this.pa.animate({width:window.innerWidth,height:window.innerHeight},this.options.ua,"swing",function(){a.pa.removeClass("animating");clearInterval(k);a.oa.setSize(a.pa.width()-n,a.pa.height()-c);a.la.find(".lb-pano_full_back").show();a.la.find(".lb-pano_full_back").css("opacity",
"1");a.la.find(".lb-pano_zoom").show()})}};b.prototype.Ta=function(){var a=this;if(null!=this.oa&&!this.oa.fullscreen()){this.la.find(".lb-pano_full_back").hide();this.la.find(".lb-pano_zoom").hide();this.la.addClass("animating");var b=e(window).scrollTop()+this.options.Ea;this.la.animate({top:b+"px"},this.options.ua,"swing",function(){a.la.removeClass("animating");a.Fa=!1});var n=a.pa.width()-a.ra.width(),c=a.pa.height()-a.ra.height(),k=setInterval(function(){var b=a.pa.width()-n,d=a.pa.height()-
c;a.oa.setSize(b,d)},1E3/60);this.pa.addClass("animating");this.pa.animate({width:this.Ra,height:this.Qa},this.options.ua,"swing",function(){a.pa.removeClass("animating");clearInterval(k);a.oa.setSize(a.pa.width()-n,a.pa.height()-c);a.la.find(".lb-pano_full").show();a.la.find(".lb-pano_full").css("opacity","1");a.la.find(".lb-pano_zoom").show();e("body").css({overflow:"auto"})})}};b.prototype.Ua=function(a){null!=this.oa&&this.oa.setFovScale(a)};return b}();e(function(){var b=new D;new E(b)})}).call(this);
